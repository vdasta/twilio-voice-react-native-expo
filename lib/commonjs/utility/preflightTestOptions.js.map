{"version":3,"names":["_InvalidArgumentError","require","_AudioCodec","_Ice","validateIceTransportPolicy","iceTransportPolicy","Object","values","IceTransportPolicy","includes","status","error","InvalidArgumentError","validateIceServer","iceServer","hasUsername","hasPassword","hasServerUrl","username","password","serverUrl","validateIceServers","iceServers","Array","isArray","validation","validateAudioCodec","audioCodec","type","AudioCodecType","maxAverageBitrate","validateAudioCodecs","audioCodecs","validatePreflightOptions","preflightTestOptions","preferredAudioCodecs"],"sources":["preflightTestOptions.ts"],"sourcesContent":["import { InvalidArgumentError } from '../error/InvalidArgumentError';\nimport type { PreflightTest } from '../PreflightTest';\nimport { AudioCodec, AudioCodecType } from '../type/AudioCodec';\nimport { IceTransportPolicy, IceServer } from '../type/Ice';\n\nexport type InvalidOptions = {\n  status: 'error';\n  error: InvalidArgumentError;\n};\n\nexport type ValidOptions<T> = { status: 'ok' } & T;\n\nexport type OptionValidation<T> = InvalidOptions | ValidOptions<T>;\n\nfunction validateIceTransportPolicy(\n  iceTransportPolicy: IceTransportPolicy\n): OptionValidation<{ iceTransportPolicy: IceTransportPolicy }> {\n  if (\n    typeof iceTransportPolicy !== 'string' ||\n    !Object.values(IceTransportPolicy).includes(iceTransportPolicy)\n  ) {\n    return {\n      status: 'error',\n      error: new InvalidArgumentError(\n        'If \"iceTransportPolicy\" is present, it must be a string of value ' +\n          '\"relay\" or \"all\".'\n      ),\n    };\n  }\n\n  return { status: 'ok', iceTransportPolicy };\n}\n\nfunction validateIceServer(\n  iceServer: IceServer\n): OptionValidation<{ iceServer: IceServer }> {\n  if (typeof iceServer !== 'object' || iceServer === null) {\n    return {\n      status: 'error',\n      error: new InvalidArgumentError('\"iceServer\" must be a non-null object.'),\n    };\n  }\n\n  const hasUsername = 'username' in iceServer;\n  const hasPassword = 'password' in iceServer;\n  const hasServerUrl = 'serverUrl' in iceServer;\n\n  if (hasUsername) {\n    const { username } = iceServer;\n    if (typeof username !== 'string') {\n      return {\n        status: 'error',\n        error: new InvalidArgumentError(\n          'If \"username\" is present in \"iceServer\", it must be a string.'\n        ),\n      };\n    }\n  }\n\n  if (hasPassword) {\n    const { password } = iceServer;\n    if (typeof password !== 'string') {\n      return {\n        status: 'error',\n        error: new InvalidArgumentError(\n          'If \"password\" is present in \"iceServer\", it must be a string.'\n        ),\n      };\n    }\n  }\n\n  if (hasServerUrl) {\n    const { serverUrl } = iceServer;\n    if (typeof serverUrl !== 'string') {\n      return {\n        status: 'error',\n        error: new InvalidArgumentError(\n          'If \"serverUrl\" is present in \"iceServer\", it must be a string.'\n        ),\n      };\n    }\n  }\n\n  if (hasUsername && hasPassword && hasServerUrl) {\n    return {\n      status: 'ok',\n      iceServer,\n    };\n  }\n\n  if (!hasUsername && !hasPassword && hasServerUrl) {\n    return {\n      status: 'ok',\n      iceServer,\n    };\n  }\n\n  return {\n    status: 'error',\n    error: new InvalidArgumentError(\n      'Ice server must have type: { serverUrl: string } | { username: ' +\n        'string; password: string; serverUrl: string }'\n    ),\n  };\n}\n\nfunction validateIceServers(\n  iceServers: IceServer[]\n): OptionValidation<{ iceServers: IceServer[] }> {\n  if (!Array.isArray(iceServers)) {\n    return {\n      status: 'error',\n      error: new InvalidArgumentError(\n        'If \"iceServers\" are present, it must be an array of valid IceServer ' +\n          'objects.'\n      ),\n    };\n  }\n\n  for (const iceServer of iceServers) {\n    const validation = validateIceServer(iceServer);\n    if (validation.status === 'error') {\n      return validation;\n    }\n  }\n\n  return {\n    status: 'ok',\n    iceServers,\n  };\n}\n\nfunction validateAudioCodec(\n  audioCodec: AudioCodec\n): OptionValidation<{ audioCodec: AudioCodec }> {\n  if (typeof audioCodec !== 'object') {\n    return {\n      status: 'error',\n      error: new InvalidArgumentError(\n        'If \"audioCodec\" is present, it must be an object.'\n      ),\n    };\n  }\n\n  if ('type' in audioCodec) {\n    const { type } = audioCodec;\n    if (\n      typeof type !== 'string' ||\n      !Object.values(AudioCodecType).includes(type)\n    ) {\n      return {\n        status: 'error',\n        error: new InvalidArgumentError(\n          'The type of \"audioCodec.type\" must be a string valued one of ' +\n            '[\"opus\", \"pcmu\"].'\n        ),\n      };\n    }\n  }\n\n  if ('maxAverageBitrate' in audioCodec) {\n    const { maxAverageBitrate } = audioCodec;\n    if (typeof maxAverageBitrate !== 'number') {\n      return {\n        status: 'error',\n        error: new InvalidArgumentError(\n          'The type of \"audioCodec.maxAverageBitrate\" must be a number.'\n        ),\n      };\n    }\n  }\n\n  return {\n    status: 'ok',\n    audioCodec,\n  };\n}\n\nfunction validateAudioCodecs(\n  audioCodecs: AudioCodec[]\n): OptionValidation<{ audioCodecs: AudioCodec[] }> {\n  if (!Array.isArray(audioCodecs)) {\n    return {\n      status: 'error',\n      error: new InvalidArgumentError(\n        'If \"preferredAudioCodecs\" is present, it must be an array of valid ' +\n          '\"audioCodec\" objects.'\n      ),\n    };\n  }\n\n  for (const audioCodec of audioCodecs) {\n    const validation = validateAudioCodec(audioCodec);\n    if (validation.status === 'error') {\n      return validation;\n    }\n  }\n\n  return {\n    status: 'ok',\n    audioCodecs,\n  };\n}\n\nexport function validatePreflightOptions(\n  preflightTestOptions: PreflightTest.Options\n): OptionValidation<{ preflightTestOptions: PreflightTest.Options }> {\n  if ('iceTransportPolicy' in preflightTestOptions) {\n    const validation = validateIceTransportPolicy(\n      preflightTestOptions.iceTransportPolicy!\n    );\n    if (validation.status === 'error') {\n      return validation;\n    }\n  }\n\n  if ('iceServers' in preflightTestOptions) {\n    const validation = validateIceServers(preflightTestOptions.iceServers!);\n    if (validation.status === 'error') {\n      return validation;\n    }\n  }\n\n  if ('preferredAudioCodecs' in preflightTestOptions) {\n    const validation = validateAudioCodecs(\n      preflightTestOptions.preferredAudioCodecs!\n    );\n    if (validation.status === 'error') {\n      return validation;\n    }\n  }\n\n  return {\n    status: 'ok',\n    preflightTestOptions,\n  };\n}\n"],"mappings":"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","ignoreList":[]}